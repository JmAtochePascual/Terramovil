---
import { Image } from 'astro:assets';

import menuIcon from '@assets/icons/menu-logo.svg';
import logo from '@assets/img/terramovil_logo.png';

import { NAV_LINKS } from '@data/navigations.ts';

const currentPath = Astro.url.pathname.replace(/\/$/, '');
const BASE = import.meta.env.BASE_URL.replace(/\/$/, '');
const HOME_URL = BASE || '/';
---

<header class="bg-primary sticky top-0 z-30 py-4 shadow-md lg:py-6">
	<div class="max-w-container mx-auto flex w-[95%] items-center justify-between">
		<a href={HOME_URL} class="relative z-40 cursor-pointer">
			<Image
				src={logo}
				alt="Logo Terramovil"
				width={300}
				height={27}
				class="w-[180px] object-contain lg:w-[300px]"
				loading="eager"
			/>
		</a>

		<nav class="hidden items-center md:flex lg:gap-6">
			{
				NAV_LINKS.map((link) => {
					const isActive = currentPath === link.href;
					return (
						<a
							href={link.href}
							class={`block border-b-2 p-2 text-white transition-colors lg:text-lg ${
								isActive ? 'border-white font-bold' : 'border-transparent hover:border-white/50 hover:text-white/90'
							}`}>
							{link.label}
						</a>
					);
				})
			}
		</nav>

		<button id="open-menu-btn" class="text-white focus:outline-none md:hidden" aria-label="Abrir menú de navegación">
			<Image src={menuIcon} alt="Menú" width={32} height={32} class="h-8 w-8" />
		</button>
	</div>

	<div
		id="menu-backdrop"
		class="pointer-events-none fixed inset-0 z-40 bg-black/60 opacity-0 transition-opacity duration-300"
		aria-hidden="true">
	</div>

	<aside
		id="mobile-menu"
		class="bg-primary fixed top-0 right-0 z-50 h-full w-[80%] max-w-sm translate-x-full transform shadow-2xl transition-transform duration-300 ease-in-out">
		<div class="flex h-full flex-col">
			<div class="flex items-center justify-between border-b border-gray-100 p-6">
				<span class="text-xl font-bold tracking-wider text-white uppercase">Menú</span>

				<button id="close-menu-btn" class="p-2 text-white transition-colors" aria-label="Cerrar menú">
					<svg
						xmlns="http://www.w3.org/2000/svg"
						fill="none"
						viewBox="0 0 24 24"
						stroke-width="2"
						stroke="currentColor"
						class="h-8 w-8">
						<path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"></path>
					</svg>
				</button>
			</div>

			<nav class="flex-1 overflow-y-auto px-4 py-6">
				<ul class="flex flex-col gap-2">
					{
						NAV_LINKS.map((link) => {
							const isActive = currentPath === link.href;
							return (
								<li>
									<a
										href={link.href}
										class={`block rounded-lg px-4 py-3 text-lg font-medium transition-colors ${
											isActive ? 'text-primary bg-red-50 font-bold' : 'text-white hover:bg-white/50 hover:text-white'
										}`}>
										{link.label}
									</a>
								</li>
							);
						})
					}
				</ul>
			</nav>

			<div class="border-t border-gray-100 p-6">
				<a href={HOME_URL} class="block text-center text-sm font-medium text-white">© Terramovil</a>
			</div>
		</div>
	</aside>
</header>

<script>
	// LÓGICA DEL MENÚ
	document.addEventListener('DOMContentLoaded', () => {
		const openBtn = document.getElementById('open-menu-btn');
		const closeBtn = document.getElementById('close-menu-btn');
		const backdrop = document.getElementById('menu-backdrop');
		const menu = document.getElementById('mobile-menu');
		const body = document.body;

		// Función para abrir
		const openMenu = () => {
			// Mostrar backdrop
			backdrop?.classList.remove('opacity-0', 'pointer-events-none');
			backdrop?.classList.add('opacity-100', 'pointer-events-auto');

			// Deslizar menú
			menu?.classList.remove('translate-x-full');
			menu?.classList.add('translate-x-0');

			// Bloquear scroll
			body.style.overflow = 'hidden';
		};

		// Función para cerrar
		const closeMenu = () => {
			// Ocultar backdrop
			backdrop?.classList.remove('opacity-100', 'pointer-events-auto');
			backdrop?.classList.add('opacity-0', 'pointer-events-none');

			// Ocultar menú
			menu?.classList.remove('translate-x-0');
			menu?.classList.add('translate-x-full');

			// Restaurar scroll
			body.style.overflow = '';
		};

		// Event Listeners
		openBtn?.addEventListener('click', openMenu);
		closeBtn?.addEventListener('click', closeMenu);
		backdrop?.addEventListener('click', closeMenu);

		// Cerrar al hacer click en un enlace (para que no se quede abierto al navegar)
		const menuLinks = menu?.querySelectorAll('a');
		menuLinks?.forEach((link) => {
			link.addEventListener('click', closeMenu);
		});
	});
</script>
